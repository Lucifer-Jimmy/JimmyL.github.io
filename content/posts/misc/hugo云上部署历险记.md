+++
date = '2025-07-29T19:59:04+08:00'
draft = false
title = 'Hugo 云上部署历险记'
categories = ['杂谈']
tags = ['Misc', '杂谈', 'Hugo' ,'Cloudflare']

+++

这篇文章的主要内容是关于我在重新构建我的 Hugo 博客，使用 Cloudflare Pages 去部署我的博客遇到的一个神奇的坑以及解决方法。

<!--more-->

### 起因

首先，我简单地描述一下我遇到的问题，由于我没有将我博客文章中的图片也上云，所以我采用的是将图片也放置在我的项目中，跟随博客一起部署到 Cloudflare Pages 上，但是当我完成部署之后，我发现在我文章中图片的路径正确的情况下，竟然无妨访问到图片资源，以下是我的项目结构（只保留关键部分）。

```plaintext
content/
│
├─friends/
│   └─index.md
│
└─posts/
    ├─misc/
    │
    ├─WebStudy/
    │   │
    │   ├─assets/
    │   │
    │   └─xxx.md
    │
    └─WriteUP/
        └─xxx.md
```

由于 Hugo 的特性，Hugo 会将 `xxx.md` 中的 `xxx` 当成路径一部分来处理，也就是说如果我们将 markdown 的图片链接写成 `![](assets/aaa.png)` 的话，Hugo 就会将这个链接处理为 `/zh-cn/posts/webstudy/xxx/assets/aaa.png`，这样的话我们就当然无法正确访问 `assets` 中的图片资源，正确的链接形式应该是写成 `![](../assets/aaa.png)`。

当然，我前面也提到了，我遇到的问题并不是因为图片路径不正确而导致无法访问图片资源，那就很奇怪了，而且我在本地调试的时候图片是可以正常加载出来的，这让我怀疑可能是 Cloudflare 的问题了。

### 深入研究

我尝试直接通过链接去直接访问图片资源，发现竟然也是访问不到了，这就让我怀疑可能是构建过程中出了问题，我去查看 Cloudflare Pages 构建时”资产已上传“部分，查看我的图片是否也被构建到工作目录 `/public` 中。我一看，好家伙，原来问题在这。

![51f3dc098a3ea8d1a01a48424928b417](../assets/51f3dc098a3ea8d1a01a48424928b417.png)

我的 `assets` 目录和我文章竟然不在同一个目录下，也正是这个问题才导致了我无法正常访问我文章中的图片，那么为什么会出现这个问题？为什么本地调试的时候又能够正常访问呢？

首先，我们知道 Hugo 在构建博客的过程中，Hugo 会将路径中的大写字母全部转成小写，并且会输出到工作目录即 `/public` 目录中，但是我们发现 Hugo 并没有对图片所在的目录进行路径的大小写转换，这就导致了我们无法访问到相应的图片资源了。

而为什么我们本地能够访问？由于我本地环境是 Windows 环境，而 Windows 系统是默认对文件路径的大小写不敏感的，也就是说即使路径大小写不一样，最终还是能访问到里面的内容。而我们的服务端（远端）的环境大概率是 Linux 环境，是对路径的大小写敏感的，自然就不能访问到 `assets` 目录了。

### 解决方法

我们只需要将路径全部设置成小写就能够解决这个问题，但是我们发现直接在 Windows 上对目录的大小写进行修改，Git 是无法识别到我们的修改的，原因就是我们之前提到的对大小写不敏感的问题，Git 有一个配置项 `core.ignorecase`，在 Windows/macOS 上默认是为 `true`。（忽略大小写差异）

那么如何让 Git 识别到大小写的更改呢？我们有两种方法。

#### 方法一

通过“删除 - 新增”的方式强制 Git 记录变化。

```bash
# 1. 先将原文件夹从 Git 暂存区移除（不删除本地文件）
git rm -r --cached <Folder>

# 2. 手动将本地文件夹改名为新大小写（例如：Folder → folder）

# 3. 将新文件夹添加到 Git 暂存区
git add <folder>

# 4. 提交变更
git commit -m "changefoldercase"
```

#### 方法二

`git mv` 可以强制 Git 记录大小写变化，无需手动删除。

```bash
# 语法：git mv 旧文件夹名 新文件夹名
git mv Folder folder

# 提交变更
git commit -m "changefoldercase"
```

